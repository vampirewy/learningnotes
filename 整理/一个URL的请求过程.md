<!--
 * @Author: your name
 * @Date: 2020-06-24 09:08:19
 * @LastEditTime: 2020-06-27 10:22:10
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /learningnotes/整理/一个URL的请求过程.md
-->

### 一个 URL 请求过程的步骤

#### 浏览器缓存[缓存相关内容](./性能优化.md)

假设当这个 URL 非第一次请求，会触发浏览器缓存策略；如果是第一次请求的话，会直接从服务器拉取

#### DNS 域名解析

> DNS，全名 Domain Name System，域名系统的英文缩写。将域名与 IP 地址相映射的分布式数据库

作用：根据域名查出与之对应的 IP 地址

#### 建立 TCP/IP(面向连接) 连接

> TCP/IP 协议栈是一组不同层次上的多个协议的组合，通常被认为是一个四层协议系统，与 OSI 的七层模型相对应。HTTP 协议是基于 TCP/IP 协议模型来传输信息。TCP/IP 是面向连接的。
> ![TCP/IP协议栈的组成](../image/TCP:IP.jpg)

##### 什么是 OSI(七层) 模型

> OSI 模型全名 Open System InterConnect 即开放式系统互联，是国际标准化组织(ISO)提出的一个试图使各种计算机在世界范围内互连为网络的标准框架，简称 OSI。
> 计算机通讯需要用到必要的软件支持，它就是计算机网络参考模型（即计算机网络软件），最经典的就是我们所要讲解的 OSI 模型。它是通过一个机器上的一个应用进程与另一个机器上的进程进行信息交互。
> OSI 是一个逻辑上的定义，是个规范，它把网络从逻辑上分为了 7 层

![OSI7层模型](../image/OSI.png)

##### OSI 和 TCP 模型对应

![OSI和TCP](../image/OSI和TCP模型.png)

> 运输层，即传输层，主要为两台主机上的应用程序提供端到端的通信。TCP/IP 协议中，包含了两个不同的传输协议：TCP(传输控制协议) 和 UDP(用户数据报协议)

##### TCP 与 UDP 的区别

1. TCP 是可靠的，虽然会存在丢包的现象，但能追踪到数据。TCP 采用超时重传、发送和接收端到端的确认分组等机制。
2. UDP 是不可靠的，只负责将数据报传送至另一端，不保证数据能到达另一端。UDP 协议任何必需的可靠性必须由应用层来提供。

浏览器在发送 HTTP 请求之前，需要在浏览器和服务器之间建立一条 TCP/IP 连接。**一次 TCP 连接主要分为三个部分：建立连接(TCP 三次握手)、数据传输、断开连接(TCP 四次挥手)**，如图下：
![一次TCP连接共分为三部分](../image/一次TCP连接的三步.png)

##### TCP 三次握手

**目的：TCP 三次握手是为了同步连接双方的序列号和确认号并交换 TCP 窗口大小信息。**

![三次握手](../image/TCP三次握手.jpg)

1. **第一次握手**：由客户端发起 TCP 连接，先向服务端发出连接请求报文段(SNY 报文段，其 SYN 标志被置位)设置首部中的同步 SYN = 1，同时发送初始序号 seq = x，客户端进入 SYN_SEND 状态，等待服务器的确认
2. **第二次握手**：服务器接收到请求报文后即 SYN = 1，对报文段进行确认，设置应答号 ACK = x + 1(客户端发送的 seq+1)，同时服务端将 SYN 位置为 1，seq = y。服务器将上述信息一并发送给客户端，此时服务器进入 SYN_RECV 状态
3. **第三次握手**：客户端收到服务器发送过来的 SYN + ACK + SEQ 后，然后设置 ack = y(服务器 seq + 1) +1 发送给服务端，服务器和客户端都进入 ESTABLISHED 状态，三次握手完成

##### 为什么是三次握手

就跟人打电话是一样的场景
A：喂，在吗？
B：我在，你听的到我吗？
A：我能听到

#### HTTP 请求与响应

#### 浏览器获得资源并渲染页面

#### 浏览器请求获取其他资源

#### 关闭 TCP/IP 连接

##### TCP 四次挥手
